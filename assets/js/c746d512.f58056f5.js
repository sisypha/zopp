"use strict";(globalThis.webpackChunkzopp_docs=globalThis.webpackChunkzopp_docs||[]).push([[7971],{4356(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"self-hosting/server","title":"Server Deployment","description":"Deploy the zopp server.","source":"@site/docs/self-hosting/server.md","sourceDirName":"self-hosting","slug":"/self-hosting/server","permalink":"/zopp/self-hosting/server","draft":false,"unlisted":false,"editUrl":"https://github.com/faiscadev/zopp/tree/main/docs/docs/self-hosting/server.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Server Deployment","description":"Deploy the zopp server."},"sidebar":"docs","previous":{"title":"Self-Hosting","permalink":"/zopp/self-hosting/"},"next":{"title":"Docker Compose","permalink":"/zopp/self-hosting/docker-compose"}}');var i=r(4848),o=r(8453);const t={sidebar_position:2,title:"Server Deployment",description:"Deploy the zopp server."},l="Server Deployment",a={},c=[{value:"Binary Installation",id:"binary-installation",level:2},{value:"Docker Deployment",id:"docker-deployment",level:2},{value:"Systemd Service",id:"systemd-service",level:2},{value:"Creating Invites",id:"creating-invites",level:2},{value:"Email Verification",id:"email-verification",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Email Providers",id:"email-providers",level:3},{value:"Resend (recommended for production)",id:"resend-recommended-for-production",level:4},{value:"SMTP",id:"smtp",level:4},{value:"Docker Example",id:"docker-example",level:3},{value:"Verification Flow",id:"verification-flow",level:3},{value:"Disabling Verification",id:"disabling-verification",level:3},{value:"Health Checks",id:"health-checks",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"server-deployment",children:"Server Deployment"})}),"\n",(0,i.jsx)(n.p,{children:"This guide covers deploying the zopp server in various environments."}),"\n",(0,i.jsx)(n.h2,{id:"binary-installation",children:"Binary Installation"}),"\n",(0,i.jsx)(n.p,{children:"Download and run the server binary:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Download\ncurl -fsSL https://github.com/faiscadev/zopp/releases/latest/download/zopp-server-linux-amd64 -o zopp-server\nchmod +x zopp-server\n\n# Run with SQLite (default)\n./zopp-server serve\n\n# Run with custom database path\n./zopp-server serve --db /var/lib/zopp/zopp.db\n\n# Run with PostgreSQL\nDATABASE_URL=postgres://user:pass@localhost/zopp ./zopp-server serve\n\n# Run with TLS\n./zopp-server serve \\\n  --tls-cert /path/to/server.crt \\\n  --tls-key /path/to/server.key\n"})}),"\n",(0,i.jsx)(n.h2,{id:"docker-deployment",children:"Docker Deployment"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# SQLite\ndocker run -d \\\n  --name zopp-server \\\n  -p 50051:50051 \\\n  -v zopp-data:/data \\\n  ghcr.io/faiscadev/zopp-server:latest\n\n# PostgreSQL\ndocker run -d \\\n  --name zopp-server \\\n  -p 50051:50051 \\\n  -e DATABASE_URL=postgres://user:pass@host:5432/zopp \\\n  ghcr.io/faiscadev/zopp-server:latest\n\n# With TLS\ndocker run -d \\\n  --name zopp-server \\\n  -p 50051:50051 \\\n  -v /path/to/certs:/certs:ro \\\n  ghcr.io/faiscadev/zopp-server:latest \\\n  serve --tls-cert /certs/server.crt --tls-key /certs/server.key\n"})}),"\n",(0,i.jsx)(n.h2,{id:"systemd-service",children:"Systemd Service"}),"\n",(0,i.jsx)(n.p,{children:"For production Linux deployments:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"# /etc/systemd/system/zopp.service\n[Unit]\nDescription=zopp Secrets Manager\nAfter=network.target\n\n[Service]\nType=simple\nUser=zopp\nExecStart=/usr/local/bin/zopp-server serve --db /var/lib/zopp/zopp.db\nRestart=always\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\nsudo systemctl enable zopp\nsudo systemctl start zopp\n"})}),"\n",(0,i.jsx)(n.h2,{id:"creating-invites",children:"Creating Invites"}),"\n",(0,i.jsx)(n.p,{children:"To bootstrap the first user:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# SQLite\n./zopp-server invite create --expires-hours 48 --db /var/lib/zopp/zopp.db\n\n# PostgreSQL\nDATABASE_URL=postgres://user:pass@localhost/zopp ./zopp-server invite create --expires-hours 48\n\n# Docker\ndocker exec zopp-server zopp-server invite create --expires-hours 48\n"})}),"\n",(0,i.jsx)(n.h2,{id:"email-verification",children:"Email Verification"}),"\n",(0,i.jsx)(n.p,{children:"The server supports email verification for new users joining the system. When enabled, users must verify their email address before their principal is fully activated."}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Email verification is configured via environment variables:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Enable/disable verification (default: true when email is configured)\nZOPP_EMAIL_VERIFICATION_REQUIRED=true\n\n# Sender configuration\nZOPP_EMAIL_FROM=noreply@yourdomain.com\nZOPP_EMAIL_FROM_NAME="Zopp Security"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"email-providers",children:"Email Providers"}),"\n",(0,i.jsx)(n.p,{children:"Choose one of the supported email providers:"}),"\n",(0,i.jsx)(n.h4,{id:"resend-recommended-for-production",children:"Resend (recommended for production)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ZOPP_EMAIL_PROVIDER=resend\nRESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nZOPP_EMAIL_FROM=noreply@yourdomain.com\n"})}),"\n",(0,i.jsx)(n.h4,{id:"smtp",children:"SMTP"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ZOPP_EMAIL_PROVIDER=smtp\nSMTP_HOST=smtp.example.com\nSMTP_PORT=587\nSMTP_USERNAME=user@example.com\nSMTP_PASSWORD=your_password\nSMTP_USE_TLS=true\nZOPP_EMAIL_FROM=noreply@yourdomain.com\n"})}),"\n",(0,i.jsx)(n.h3,{id:"docker-example",children:"Docker Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'docker run -d \\\n  --name zopp-server \\\n  -p 50051:50051 \\\n  -e DATABASE_URL=postgres://user:pass@host:5432/zopp \\\n  -e ZOPP_EMAIL_PROVIDER=resend \\\n  -e RESEND_API_KEY=re_xxxxxxxxxxxxx \\\n  -e ZOPP_EMAIL_FROM=noreply@yourdomain.com \\\n  -e ZOPP_EMAIL_FROM_NAME="Zopp Security" \\\n  ghcr.io/faiscadev/zopp-server:latest\n'})}),"\n",(0,i.jsx)(n.h3,{id:"verification-flow",children:"Verification Flow"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["User runs ",(0,i.jsx)(n.code,{children:"zopp join <invite> <email>"})]}),"\n",(0,i.jsx)(n.li,{children:"Server sends a 6-digit verification code to the email"}),"\n",(0,i.jsx)(n.li,{children:"User enters the code in the CLI"}),"\n",(0,i.jsx)(n.li,{children:"Upon successful verification, the principal is activated"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The verification code:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Expires after 15 minutes"}),"\n",(0,i.jsx)(n.li,{children:"Allows 5 attempts per code"}),"\n",(0,i.jsx)(n.li,{children:"Rate limited to 3 codes per hour per email"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"disabling-verification",children:"Disabling Verification"}),"\n",(0,i.jsx)(n.p,{children:"To disable email verification (not recommended for production):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ZOPP_EMAIL_VERIFICATION_REQUIRED=false\n"})}),"\n",(0,i.jsx)(n.p,{children:"Without email verification configured, users can join immediately without verification."}),"\n",(0,i.jsx)(n.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,i.jsx)(n.p,{children:"The server exposes health endpoints on port 8080:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Liveness\ncurl http://localhost:8080/healthz\n\n# Readiness\ncurl http://localhost:8080/readyz\n"})}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/self-hosting/database",children:"Database Setup"})," - Configure SQLite or PostgreSQL"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/self-hosting/tls",children:"TLS Configuration"})," - Secure your deployment"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>l});var s=r(6540);const i={},o=s.createContext(i);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);